# RBAC Authorization

In this doc, we'll keep track of the permissions requested across different resources, organized by `APIGroups`, `Resources`, `Verbs`, and the `Component` requesting them. Each permission includes comments to explain its purpose.

## ClusterRole

| Component    | APIGroups         | Resources                                                  | Resource Names | Verbs                                           | Comments                                                                                                                  |
| ------------ | ----------------- | ---------------------------------------------------------- | -------------- | ----------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| Odiglet      | ""                | pods                                                       | \_             | get, list, watch                                | Needed for language detection.                                                                                            |
| Odiglet      | ""                | pods/status                                                | \_             | get                                             | Needed for language detection.                                                                                            |
| Odiglet      | ""                | nodes                                                      | \_             | get, list, watch                                | Needed for virtual device registration.                                                                                   |
| Odiglet      | apps              | deployments, daemonsets, statefulsets                      | \_             | get, list, watch                                | Needed for language detection (temporary until new detection logic is ready).                                             |
| Odiglet      | apps              | deployments/status, daemonsets/status, statefulsets/status | \_             | get                                             | Needed for language detection (temporary until new detection logic is ready).                                             |
| Odiglet      | odigos.io         | instrumentationinstances                                   | \_             | create, get, list, patch, update, watch, delete | Manages instrumentation instances for process state storage.                                                              |
| Odiglet      | odigos.io         | instrumentationinstances/status                            | \_             | get, patch, update                              | Updates status of instrumentation instances.                                                                              |
| Odiglet      | odigos.io         | instrumentationconfigs                                     | \_             | get, list, watch, patch, update                 | Manages instrumentation configurations (future update for runtime details storage).                                       |
| Odiglet      | odigos.io         | instrumentationconfigs/status                              | \_             | get, patch, update                              | Updates status of instrumentation configurations.                                                                         |
| Odiglet      | policy            | podsecuritypolicies                                        | \_             | use                                             | Allows using privileged PSP (if enabled).                                                                                 |
| Instrumentor | ""                | nodes, namespaces                                          | \_             | get, list, watch                                | Tracks runtime detection and resource labels for instrumentation.                                                         |
| Instrumentor | apps              | daemonsets, deployments, statefulsets                      | \_             | get, list, watch, update, patch                 | Adjusts pod specifications for instrumentation.                                                                           |
| Instrumentor | odigos.io         | instrumentedapplications                                   | \_             | delete, get, list, watch                        | Deletes deprecated CR.                                                                                                    |
| Instrumentor | odigos.io         | instrumentationconfigs                                     | \_             | create, delete, get, list, patch, update, watch | Manages instrumentation configurations.                                                                                   |
| Instrumentor | odigos.io         | sources                                                    | \_             | create, delete, get, list, patch, update, watch | Manages Source configurations.                                                                                            |
| Scheduler    | odigos.io         | instrumentationconfigs                                     | \_             | get, list, watch                                | Monitors changes in instrumentation configurations for scheduling updates.                                                |
| Autoscaler   | odigos.io         | instrumentationconfigs                                     | \_             | get, list, watch                                | Reads instrumentation configurations to populate the `data-collector` configmaps.                                         |
| Collector    | ""                | nodes/stats, nodes/proxy                                   | \_             | get, list                                       | Retrieves metrics for telemetry purposes.                                                                                 |
| Collector    | ""                | pods                                                       | \_             | get, list                                       | Accesses metadata for resource name processors.                                                                           |
| Collector    | apps              | replicasets, deployments, daemonsets, statefulsets         | \_             | get, list                                       | Fetches application details for instrumentation.                                                                          |
| Collector    | ""                | endpoints                                                  | \_             | get, list, watch                                | Needed for load balancer.                                                                                                 |
| Collector    | policy            | podsecuritypolicies                                        | \_             | use                                             | Supports clients enabling pod security policies (optional).                                                               |
| UI           | ""                | namespaces                                                 | \_             | get, list, patch                                | Needed to retrieve and instrument namespaces.                                                                             |
| UI           | ""                | services                                                   | \_             | get, list                                       | Required for discovering potential destinations and describing application workloads.                                     |
| UI           | ""                | pods                                                       | \_             | get, list, watch                                | Required for discovering potential destinations and describing application workloads, and for updating collector metrics. |
| UI           | apps              | deployments, statefulsets, daemonsets                      | \_             | get, list, patch, update                        | Required for instrumentation of application sources.                                                                      |
| UI           | apps              | replicasets                                                | \_             | get, list                                       | Needed for describing application and resource relationships.                                                             |
| UI           | odigos.io         | instrumentationconfigs, instrumentationinstances           | \_             | get, list, watch                                | Monitors and retrieves configurations for instrumentation.                                                                |
| UI           | odigos.io         | sources                                                    | \_             | get, list, create, delete                       | Manages sources for instrumentation and monitoring.                                                                       |
| UI           | actions.odigos.io | \_                                                         | \*             | get, list, create, patch, update, delete        | Handles pipeline actions for custom logic.                                                                                |

---

## Role

| Component    | APIGroups         | Resources                                 | Resource Names   | Verbs                                                             | Comments                                                                                       |
| ------------ | ----------------- | ----------------------------------------- | ---------------- | ----------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| Odiglet      | odigos.io         | collectorsgroups, collectorsgroups/status | \*               | get, list, watch                                                  | Reads enabled signals for each source (temporary until migration to instrumentation config).   |
| Odiglet      | ""                | configmaps                                | \*               | get, list, watch                                                  | Reads `odigos_config` for ignored containers.                                                  |
| Instrumentor | ""                | configmaps                                | effective-config | get, list, watch                                                  | Accesses `odigos-config` for instrumentation configuration.                                    |
| Instrumentor | odigos.io         | collectorsgroups                          | \*               | get, list, watch                                                  | Monitors collectors and their statuses.                                                        |
| Scheduler    | ""                | configmaps                                | \*               | get, list, watch                                                  | Reacts and reconciles `odigos-config` changes to effective config.                             |
| Scheduler    | ""                | configmaps                                | effective-config | create, patch                                                     | Applies effective config after reconciling (defaulting and profile applying) and reacts to it. |
| Scheduler    | odigos.io         | collectorsgroups                          | \*               | get, list, create, patch, update, watch, delete                   | Manages `collectorsgroups`.                                                                    |
| Scheduler    | odigos.io         | destinations                              | \*               | get, list, watch                                                  | Tracks destinations for scheduling behavior.                                                   |
| Autoscaler   | ""                | configmaps, services                      | \*               | get, list, watch, create, patch, update, delete, deletecollection | Manages collector configurations and services.                                                 |
| Autoscaler   | apps              | daemonsets, deployments                   | \*               | get, list, watch, create, patch, update, delete, deletecollection | Oversees collector deployments and readiness statuses.                                         |
| Autoscaler   | apps              | daemonsets/status, deployments/status     | \*               | get                                                               | Reads readiness statuses.                                                                      |
| Autoscaler   | autoscaling       | horizontalpodautoscalers                  | \*               | create, patch, update, delete                                     | Implements autoscaling for gateway collectors.                                                 |
| Autoscaler   | odigos.io         | destinations                              | \*               | get, list, watch                                                  | Tracks and synchronizes destination configurations.                                            |
| Autoscaler   | odigos.io         | collectorsgroups, destinations/status     | \*               | get, patch, update                                                | Monitors and updates statuses of collectors groups and destinations.                           |
| Autoscaler   | odigos.io         | sources                                   | \*               | get, list, watch                                                  | Generate Odigos routing processors                                                             |
| UI           | ""                | configmaps                                | \*               | get, list                                                         | Reads `odigos-config` for UI configuration.                                                    |
| UI           | ""                | secrets                                   | \*               | get, list, create, patch, update                                  | Manages destination secrets for configurations.                                                |
| UI           | odigos.io         | instrumentationrules, destinations        | \*               | get, list, create, patch, update, delete                          | CRUD for destinations and instrumentation rules.                                               |
| UI           | odigos.io         | collectorsgroups                          | \*               | get, list                                                         | Monitors groupings of collectors for UI updates.                                               |
| UI           | actions.odigos.io | \*                                        | \*               | get, list, create, patch, update, delete                          | Pipeline action management.                                                                    |
